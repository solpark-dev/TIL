# [TIL] AWS 클라우드 실습 - 도메인 연결과 HTTPS/ALB 구축

**날짜:** 2025년 12월 04일  
**주제:** AWS Route 53, ACM, ALB를 활용한 독자적인 도메인 및 HTTPS 보안 환경 구축

---

## 📋 1. 실습 개요 및 사전 준비

어제 진행했던 VPC 환경 위에서, 실제 도메인을 연결하고 보안(HTTPS)이 적용된 로드 밸런서(ALB)를 구축하는 과정을 진행했다. (강사님 ID: `ebeaver`, 내 실습 도메인 적용)

### 1-1. 인프라 환경 구성
* 기존 실습 내용 이어서 진행.
* **추가 작업:** `Day03-Part02_zone_2c_제외-private.txt` 파일을 참조하여 **가용 영역 2c**에 대한 서브넷 구성을 추가함. (ALB는 최소 2개 이상의 가용 영역이 필요하기 때문)

---

## 🌍 2. Route 53 호스팅 영역 생성 및 도메인 연결

사용자가 외우기 힘든 IP 대신 도메인 이름으로 접속할 수 있게 설정하는 과정.

**1) Route 53 호스팅 영역 생성**
* AWS Route 53 > '호스팅 영역' > **[호스팅 영역 생성]**
* 도메인 이름 입력 후 생성 (퍼블릭 호스팅 영역)

**2) 네임서버(NS) 등록**
* 생성된 호스팅 영역의 `NS` 레코드 값 4개를 복사하여 별도 파일에 보관.
* 도메인 구입처(가비아 등) 관리 페이지로 이동하여 네임서버 설정에 AWS의 NS 주소 4개를 등록.
    * *이유: 도메인 접속 요청이 오면 AWS Route 53이 길을 안내하도록 권한을 위임하는 것.*

**3) 연결 확인**
* Route 53에서 레코드가 정상적으로 조회되는지 확인.

---

## 🔒 3. ACM 인증서 발급 (HTTPS 보안)

웹사이트에 자물쇠 아이콘(보안 접속)을 띄우기 위해 AWS Certificate Manager(ACM)에서 인증서를 발급받음.

**1) 인증서 요청**
* ACM > **[인증서 요청]** > 퍼블릭 인증서 요청
* 도메인 이름 입력 (예: `*.mydomain.com` 또는 `mydomain.com`)
* 검증 방법: **DNS 검증** (권장)

**2) 도메인 소유권 검증**
* 요청 직후 '검증 대기 중' 상태임.
* **[Route 53에서 레코드 생성]** 버튼 클릭.
    * *원리: 내 도메인 DNS에 AWS가 지정한 암호(CNAME)를 적어둠으로써 "이 도메인 내꺼 맞음"을 증명함.*

**3) 검증 확인**
* Route 53에 CNAME 레코드가 자동 생성됨. 잠시 후 인증서 상태가 '발급됨'으로 변경됨.

---

## ⚖️ 4. 로드 밸런서(ALB) 구성

트래픽을 분산하고 HTTPS 암호화를 처리해주는 ALB를 생성.

### 4-1. 대상 그룹 (Target Group) 생성
ALB가 트래픽을 토스해줄 목적지(EC2) 묶음.

* **경로:** EC2 > 로드 밸런싱 > 대상 그룹
* **설정:**
    * 유형: 인스턴스
    * 프로토콜: **HTTP 8080** (Spring Boot/Tomcat 등이 8080을 쓰므로)
    * VPC: 실습용 VPC 선택

* **대상 등록:**
    * 실행 중인 WAS 인스턴스 선택 -> **[아래에 보류 중인 것으로 포함]** 클릭 -> 생성 완료.

### 4-2. Application Load Balancer (ALB) 생성
* **경로:** EC2 > 로드 밸런싱 > 로드 밸런서 생성 > **ALB** 선택
* **네트워크 매핑:**
    * VPC 선택
    * **가용 영역(AZ):** 반드시 **2개 이상**의 서브넷을 선택해야 함 (고가용성 원칙).


* **리스너 및 라우팅 (핵심):**
    1.  **HTTP (80):** 리스너 생성 -> 작업: 대상 그룹으로 전달.
        * *사용자가 http로 들어와도 처리해줌.*
    2.  **HTTPS (443):** 리스너 추가 -> 프로토콜 **HTTPS** 선택.
        * 보안 리스너 설정: 아까 발급받은 **ACM 인증서** 선택.
        * 작업: 대상 그룹으로 전달.
        * *원리: ALB에서 암호를 해독(SSL Offloading)한 뒤, EC2에는 8080 포트로 평문 전달.*


---

## 🔗 5. 도메인과 로드 밸런서 연결 (최종)

ALB는 IP가 수시로 바뀌므로 A 레코드(IP 직접 입력)가 아닌 **별칭(Alias)** 기능을 사용해야 한다.

**1) Route 53 레코드 생성**
* Route 53 > 호스팅 영역 > 레코드 생성
* **설정:**
    * 레코드 이름: (비워둠, 루트 도메인용)
    * **별칭(Alias):** 활성화 (ON)
    * 트래픽 라우팅 대상:
        * Application/Classic Load Balancer 선택
        * 리전: 서울
        * 로드 밸런서: 아까 만든 ALB 선택

**2) 접속 테스트 및 추가 설정**
* 브라우저에서 `https://내도메인` 접속 시 자물쇠가 뜨고 페이지가 열리는지 확인.
* `www` 서브 도메인도 동일한 방식으로 별칭 레코드 생성.

---

## 🧹 6. 리소스 정리 (과금 방지)

실습 종료 후 반드시 아래 순서대로 삭제해야 에러가 발생하지 않음.

1.  **Route 53:** 레코드 삭제 (도메인 연결 해제)
2.  **EC2 로드 밸런서:** 삭제 (ALB 제거)
3.  **EC2 대상 그룹:** 삭제 (ALB가 지워져야 삭제 가능)
4.  **ACM:** 인증서 삭제 (ALB 연결 해제 후 가능)
5.  **EC2 인스턴스:** 종료 (Terminate)
6.  **VPC:** NAT Gateway 등 잔여 리소스 확인 후 VPC 삭제

---

## 💡 핵심 용어 정리
* **Route 53:** AWS의 DNS 서비스 (전화번호부).
* **ACM (AWS Certificate Manager):** SSL/TLS 인증서 발급 및 관리.
* **ALB (Application Load Balancer):** L7(애플리케이션 계층) 로드 밸런서. HTTPS 처리에 특화됨.
* **Target Group:** 로드 밸런서가 요청을 보낼 실제 서버들의 그룹.
* **Alias (별칭):** IP가 변동되는 AWS 리소스(ALB 등)에 도메인을 연결하는 Route 53 전용 기능.
